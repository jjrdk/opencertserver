# Introduction

## About

OpenCertServer is a certificate server based on the Enrollment over Secure Transport profile ([RFC 7030](https://datatracker.ietf.org/doc/html/rfc7030)).

This profile, called Enrollment over Secure Transport (EST), describes a simple, yet functional, certificate management protocol targeting Public Key Infrastructure (PKI) clients that need to acquire client certificates and associated Certification Authority (CA) certificates. It also supports client-generated public/private key pairs as well as key pairs generated by the CA.

## License

The project is licensed under the [MIT license](LICENSE).

## Setup

In order to add the endpoints defined in the EST profile, you need to add the necessary services and configure your web application as described below.

The exact configuration of the authentication and authorization will depend on your local authorization rules.

The EST profile requires certificate authentication, and must be configured as an authentication scheme.

### Service collection configuration:

```csharp
public IServiceCollection ConfigureServices(IServiceCollection sc)
{
    sc.AddAuthentication(CertificateAuthenticationDefaults.AuthenticationScheme).AddCertificate();
    sc.AddAuthorization();
    sc.ConfigureOptions<ConfigureCertificateAuthenticationOptions>();
    sc.AddCertificateServer(rsaPrivate, ecdsaPrivate);
}
```

In the example above ```rsaPrivate``` and ```ecdsaPrivate``` are certificate authority root certificates, for handling certificate requests for RSA and ECDSA algorithms, respectively.

### Application configuration

```csharp
public void Configure(IApplicationBuilder app)
{
    app.UseCertificateServer();
}
```

The application builder configuration internally registers: ```CertificateForwarding```, ```Routing```, ```Authentication```, ```Authorization``` and ```Endpoints```, in that order.

You can also have a look at the [tests](tests/opencertserver.tests/WebServerTests.cs) to see an example setup.

## Usage

When the server is configured, the following 3 endpoints are available:

```/.well-known/est/cacerts``` (GET): This endpoint provides the server public key certificates.

```/.well-known/est/simpleenroll``` (POST): This endpoint allows a user to enroll and receive a certificate based on a certificate request.

```/.well-known/est/simplereenroll``` (POST): This endpoint provides a renewed certificate based on the provides client certificate. This endpoint requires a client certificate which will be used both to authenticate and to process the renewal request.

## Building the Project

To build the project, run the build script (build.ps1 on Windows, build.sh on Linux/Mac). This will generate a set of nuget packages which can be used to integrate OpenCertServer into an ASP.NET Core server project.

## Reporting Issues and Bugs

When reporting issues and bugs, please provide a clear set of steps to reproduce the issue. The best way is to provide a failing test case as a pull request.

If that is not possible, please provide a set of steps which allow the bug to be reliably reproduced. These steps must also reproduce the issue on a computer that is not your own.

## Contributions

All contributions are appreciated. Please provide them as an issue with an accompanying pull request.

This is an open source project. Please respect the license terms and the fact that issues and contributions may not be handled as fast as you may wish. The best way to get your contribution adopted is to make it easy to pull into the code base.
